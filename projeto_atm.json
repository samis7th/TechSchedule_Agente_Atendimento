{
  "name": "projeto_atm",
  "nodes": [
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1177dfb8-8b50-4baf-979d-ca949be4c777",
              "name": "idConversa",
              "value": "={{ $('Webhook').item.json.body.chatLid }}",
              "type": "string"
            },
            {
              "id": "c8fcf443-5b3d-427e-9a55-d15d971dfbc3",
              "name": "Nome",
              "value": "={{ $('Webhook').item.json.body.chatName }}",
              "type": "string"
            },
            {
              "id": "a7635c93-f92b-41e4-9bc2-1327b040e980",
              "name": "Numero",
              "value": "={{ $('Webhook').item.json.body.phone }}",
              "type": "string"
            },
            {
              "id": "f513b746-11e1-408d-b9b4-28f9ec21120d",
              "name": "Mensagem",
              "value": "={{ $json.body.text.message }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        784,
        304
      ],
      "id": "d33c7a10-933f-42ed-a3ce-b0e0fad2e88c",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Edit Fields').item.json.Mensagem }}",
        "options": {
          "systemMessage": "üß© Prompt ‚Äî Agente de IA de Agendamento (HM Solu√ß√µes em TI)\n\nIdentidade:\nVoc√™ √© TechSchedule, assistente virtual da HM Solu√ß√µes em TI.\nSua fun√ß√£o √© agendar, consultar e cancelar visitas t√©cnicas de forma clara, r√°pida e educada.\n\n‚öôÔ∏è Fun√ß√µes principais\n\nAgendar visita t√©cnica\n\nConsultar agenda (buscar eventos)\n\nCancelar agendamento (deletar eventos)\n\nCada evento deve conter:\n\nT√≠tulo: [Nome do Cliente] - [Tipo de Servi√ßo]\n(Ex: ‚ÄúCarlos Souza - Instala√ß√£o de Rede Wi-Fi‚Äù)\n\nData e hora (entre 08:00 e 18:00)\n\nLocal (endere√ßo ou remoto)\n\nDescri√ß√£o: breve resumo do servi√ßo\n\nüïê Regras de opera√ß√£o\n\nAtendimentos apenas das 08:00 √†s 18:00.\n\nSempre confirmar data, hora, local e servi√ßo antes de criar ou apagar.\n\nSe o hor√°rio n√£o estiver dispon√≠vel, sugerir 3 op√ß√µes pr√≥ximas.\nEx: ‚ÄúPosso te atender √†s 09:00, 13:30 ou 16:00. Qual prefere?‚Äù\n\nNunca criar, editar ou cancelar sem confirma√ß√£o do cliente.\n\nAp√≥s confirmar, enviar resposta resumida e positiva.\n\nüí¨ Estilo de comunica√ß√£o\n\nTom: profissional, calmo e prestativo.\n\nFrases curtas, naturais e humanas.\n\nEmojis leves (üíªüìÖüôÇ) quando couber.\n\nSempre encerrar com gratid√£o e simpatia.\n\nüí≠ Exemplos de respostas\n\nSauda√ß√£o inicial:\n‚ÄúOl√°! üëã Sou o TechSchedule da HM Solu√ß√µes em TI. Posso te ajudar a agendar, consultar ou cancelar uma visita t√©cnica?‚Äù\n\nApresentar hor√°rios dispon√≠veis:\n‚ÄúHoje tenho 09:00, 11:00, 14:30 e 16:00. Qual desses hor√°rios √© melhor pra voc√™?‚Äù\n\nConfirma√ß√£o de agendamento:\n‚ÄúTudo certo! ‚úÖ Agendei Carlos Souza - Instala√ß√£o de Rede Wi-Fi para ter√ßa, √†s 14:00. Se precisar remarcar, √© s√≥ avisar!‚Äù\n\nConsulta de agenda:\n‚ÄúSuas visitas marcadas:\n‚Ä¢ 10/10 ‚Äì 09:00 ‚Äì Jo√£o Lima - Manuten√ß√£o de Servidor\n‚Ä¢ 12/10 ‚Äì 15:30 ‚Äì Ana Melo - Suporte de Rede\nQuer manter ou cancelar alguma?‚Äù\n\nCancelamento:\n‚ÄúCancelei o agendamento de Ana Melo - Suporte de Rede (12/10 √†s 15:30). Deseja reagendar outro hor√°rio?‚Äù\n\nEncerramento:\n‚ÄúObrigado pelo contato! üòä\nA HM Solu√ß√µes em TI est√° sempre √† disposi√ß√£o.‚Äù\n\nüß† Exemplos de inten√ß√µes dos clientes\n\nAgendar:\n‚ÄúQuero marcar uma visita.‚Äù / ‚ÄúTem hor√°rio amanh√£?‚Äù / ‚ÄúPreciso de suporte hoje √† tarde.‚Äù\n\nConsultar:\n‚ÄúQuais visitas tenho marcadas?‚Äù / ‚ÄúQuero confirmar o hor√°rio do t√©cnico.‚Äù\n\nCancelar:\n‚ÄúPode cancelar a visita das 15h?‚Äù / ‚ÄúN√£o vou poder amanh√£.‚Äù\n\nüîó Integra√ß√£o com Google Calendar (via n8n)\n\nAo confirmar o agendamento, o agente deve enviar ao Google Calendar os seguintes dados:\n\nCampo\tValor\nsummary\t[Nome do Cliente] - [Tipo de Servi√ßo]\nstart\t[Data e hora confirmada]\nend\t[Data e hora + dura√ß√£o padr√£o (ex: +1h)]\nlocation\t[Endere√ßo informado ou ‚ÄúAtendimento remoto‚Äù]\ndescription\tVisita t√©cnica agendada via TechSchedule (HM Solu√ß√µes em TI)"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1472,
        304
      ],
      "id": "7ba4447e-c89f-43b3-87bf-1d810304d6d8",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Edit Fields').item.json.idConversa }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        1568,
        80
      ],
      "id": "72ca37ad-cfd4-4a23-9d0a-63284706c159",
      "name": "Simple Memory"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        2112,
        128
      ],
      "id": "839af9d0-71e6-4ea2-9750-944059a2cb07",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "Receber-mensagem-zapi",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        320,
        320
      ],
      "id": "f35bab0b-55d5-40f2-aea6-e528bd7e2a3a",
      "name": "Webhook",
      "webhookId": "69195619-c012-4ef1-b6c3-93a8c85cadd0"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6103ab95-f657-4e62-8cfe-d7e75758fddb",
              "leftValue": "={{ $json.body.isGroup }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            },
            {
              "id": "dcfda64e-86d6-4861-91e6-a36912dd4c12",
              "leftValue": "={{ $json.body.isNewsletter }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            },
            {
              "id": "d87b7bde-ff12-42e0-b524-d95f238471ae",
              "leftValue": "={{ $json.body.broadcast }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        560,
        320
      ],
      "id": "fa53811b-b617-44d0-987f-330654991778",
      "name": "If"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        560,
        144
      ],
      "id": "925f6c7b-ae30-41d2-a383-1db65bb1edd2",
      "name": "No Operation, do nothing1"
    },
    {
      "parameters": {
        "method": "POST",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1872,
        128
      ],
      "id": "fe12663d-b5d1-4b04-b1b3-f5457c5f7a8f",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "operation": "formatDate",
        "date": "={{ $now }}",
        "format": "custom",
        "customFormat": "EEEE, MMMM dd yyyy 'at' hh:mm:ss",
        "options": {
          "timezone": true
        }
      },
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        1184,
        304
      ],
      "id": "a021857e-cad2-4080-a3ea-50c37e1d3ab5",
      "name": "Date & Time"
    },
    {
      "parameters": {
        "resource": "calendar",
        "calendar": {
          "__rl": true,
          "value": "584c60acf489442811177c5dead2a0575afab380dd259af7625497bf6547a7c7@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Agenda de teste N8N"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        1552,
        608
      ],
      "id": "40d58d74-45a2-4dfc-9be3-4041174238ae",
      "name": "Buscar Evento"
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "584c60acf489442811177c5dead2a0575afab380dd259af7625497bf6547a7c7@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Agenda de teste N8N"
        },
        "start": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', `2025-10-09T14:00:00-03:00)`, 'string') }}",
        "end": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', `2025-10-09T14:00:00-03:00)`, 'string') }}",
        "useDefaultReminders": false,
        "additionalFields": {
          "description": "Visita Tecnica"
        }
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        1696,
        608
      ],
      "id": "60e29be0-fe5c-42fa-8ade-895132c84c07",
      "name": "Marcar evento"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1424,
        80
      ],
      "id": "23f26e90-1442-4066-99ac-d64e8351a4aa",
      "name": "OpenAI Chat Model"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1888,
        672
      ],
      "id": "102b095a-fa18-4ede-bd28-d31094392464",
      "name": "Embeddings OpenAI1"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "tableName": {
          "__rl": true,
          "mode": "list",
          "value": ""
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1888,
        528
      ],
      "id": "dee81238-2386-4c4f-a28c-ff96464791af",
      "name": "Busca Dados"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "",
          "mode": "url"
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        992,
        304
      ],
      "id": "5a37334d-10c7-44c8-8221-1045ccf6ed4f",
      "name": "Atualiza dados",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "KiOjZ1J2yCq5iccI",
          "name": "Google Sheets account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "calendar": {
          "__rl": true,
          "mode": "list",
          "value": ""
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        1392,
        608
      ],
      "id": "7871589e-fc64-43ed-8e36-305af68bac63",
      "name": "Delete an event in Google Calendar"
    }
  ],
  "pinData": {},
  "connections": {
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Atualiza dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Evento": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Marcar evento": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Busca Dados",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Busca Dados": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Atualiza dados": {
      "main": [
        [
          {
            "node": "Date & Time",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete an event in Google Calendar": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "bdf8fe6b-ea5f-4ed7-995e-ab7be9de3e22",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "464442b33225a2e695074e17704003de02e5aaa4323e83ebb6d4cac499a38951"
  },
  "id": "OpFrrr4bAW2LW5Jd",
  "tags": []
}